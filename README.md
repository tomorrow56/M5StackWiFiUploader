# M5Stack WiFi File Uploader

[![Version](https://img.shields.io/badge/version-1.4.0-blue.svg)](https://github.com/tomorrow56/M5StackWiFiUploader)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/platform-ESP32-lightgrey.svg)](https://www.espressif.com/en/products/socs/esp32)

**M5Stackã®SDã‚«ãƒ¼ãƒ‰ã«WiFiçµŒç”±ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®Arduinoãƒ©ã‚¤ãƒ–ãƒ©ãƒª**

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€M5Stackãƒ‡ãƒã‚¤ã‚¹ä¸Šã§HTTP/WebSocketã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶çµŒç”±ã§å†™çœŸã€ãƒã‚¤ãƒŠãƒªã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’SDã‚«ãƒ¼ãƒ‰ã«ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã€è‡ªå‹•å†è©¦è¡Œã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã©ã€ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ©Ÿèƒ½ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

[English Version](README_EN.md)

## ä¸»ãªç‰¹å¾´

- **ãƒ‡ãƒ¥ã‚¢ãƒ«ãƒ—ãƒ­ãƒˆã‚³ãƒ«å¯¾å¿œ**: é«˜é€ŸãªWebSocketã¨äº’æ›æ€§ã®é«˜ã„HTTPã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: 14ç¨®é¡ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¨è‡ªå‹•å†è©¦è¡Œæ©Ÿèƒ½
- **ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º**: è»¢é€é€Ÿåº¦ã€æ®‹ã‚Šæ™‚é–“ã€å…¨ä½“é€²æ—ãªã©ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¿½è·¡
- **ãƒ¢ãƒ€ãƒ³Web UI**: ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªWebã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **æŸ”è»Ÿãªè¨­å®š**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã€æ‹¡å¼µå­ã€åŒæ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ•°ãªã©ã‚’è‡ªç”±ã«è¨­å®šå¯èƒ½
- **ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®å„æ®µéšï¼ˆé–‹å§‹ã€é€²æ—ã€å®Œäº†ã€ã‚¨ãƒ©ãƒ¼ï¼‰ã§ã‚«ã‚¹ã‚¿ãƒ å‡¦ç†ã‚’å®Ÿè¡Œå¯èƒ½
- **æ“ä½œã®åˆ¶å¾¡**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ä¸€æ™‚åœæ­¢ã€å†é–‹ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒå¯èƒ½
- **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: SDã‚«ãƒ¼ãƒ‰å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Web UIçµŒç”±ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- **ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º**: ãƒ•ã‚¡ã‚¤ãƒ«åã€ã‚µã‚¤ã‚ºã€æ›´æ–°æ—¥æ™‚ã‚’è¡¨å½¢å¼ã§è¡¨ç¤º
- **è»½é‡è¨­è¨ˆ**: ESP32ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä¸­å¿ƒã«æ§‹æˆã•ã‚Œã€å¤–éƒ¨ä¾å­˜ã‚’æœ€å°é™ã«æŠ‘åˆ¶

## å¯¾å¿œãƒ¢ãƒ‡ãƒ«

- M5Stack Core
- M5Stack Core2
- M5Stack CoreS3

## ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

- **M5Unified** 0.2.11ä»¥é™
- `WiFi`, `WebServer`, `FS`, `SD` (ESP32 Arduinoãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å†…è”µ)
- `WebSocketsServer`
- `ArduinoJson`

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

![system diagram](img/system.png)

## ã‚¯ãƒ©ã‚¹æ§‹æˆ

![class diagram](img/class.png)

## ğŸš€ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1.  ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã‹ã‚‰æœ€æ–°ç‰ˆã® `M5StackWiFiUploader.zip` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
2.  Arduino IDEã§ `ã‚¹ã‚±ãƒƒãƒ` -> `ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰` -> `.ZIPå½¢å¼ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«` ã‚’é¸æŠã—ã¾ã™ã€‚
3.  ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

## ğŸ’¡ ä½¿ã„æ–¹

åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ `examples/FullFeaturedDemo/FullFeaturedDemo.ino` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```cpp
#include <M5Unified.h>
#include <WiFi.h>
#include "M5StackWiFiUploader.h"
#include "SDCardManager.h"

const char* WIFI_SSID = "your_ssid";
const char* WIFI_PASSWORD = "your_password";

M5StackWiFiUploader uploader;

void setup() {
    auto cfg = M5.config();
    M5.begin(cfg);
    Serial.begin(115200);
    
    // SDã‚«ãƒ¼ãƒ‰åˆæœŸåŒ–
    if (!SDCardManager::initialize()) {
        Serial.println("SD Card initialization failed!");
        return;
    }
    
    // WiFiæ¥ç¶š
    WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
    while (WiFi.status() != WL_CONNECTED) { 
        delay(500); 
        Serial.print(".");
    }
    Serial.println("\nWiFi Connected!");

    // WebSocketã‚’æœ‰åŠ¹åŒ–
    uploader.enableWebSocket(true);

    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’é–‹å§‹
    if (uploader.begin(80, "/uploads")) {
        Serial.println("Server started successfully!");
        Serial.printf("Server URL: http://%s\n", WiFi.localIP().toString().c_str());
    }

    // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
    uploader.onUploadComplete([](const char* filename, uint32_t size, bool success) {
        if (success) {
            Serial.printf("Upload complete: %s\n", filename);
        }
    });
}

void loop() {
    M5.update();
    uploader.handleClient();
}
```

## ğŸ“¥ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

### ä¸»ãªæ©Ÿèƒ½

- **ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º**: SDã‚«ãƒ¼ãƒ‰å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨å½¢å¼ã§è¡¨ç¤º
- **è©³ç´°æƒ…å ±è¡¨ç¤º**: ãƒ•ã‚¡ã‚¤ãƒ«åã€ã‚µã‚¤ã‚ºã€æ›´æ–°æ—¥æ™‚ã‚’ç¢ºèª
- **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- **å‰Šé™¤**: ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
- **æ›´æ–°**: ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’æ‰‹å‹•ã§æ›´æ–°

### Web UI

Web UIã§ã¯ã€ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

| é …ç›® | èª¬æ˜ |
|------|------|
| ãƒ•ã‚¡ã‚¤ãƒ«å | ã‚¯ãƒªãƒƒã‚¯ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ |
| ã‚µã‚¤ã‚º | äººé–“ãŒèª­ã¿ã‚„ã™ã„å½¢å¼ï¼ˆKB, MBï¼‰ |
| æ›´æ–°æ—¥æ™‚ | YYYY-MM-DD HH:MMå½¢å¼ |
| æ“ä½œ | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ |

### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ |
|---------------|---------|------|
| `/api/files/list` | GET | è©³ç´°ãªãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾— |
| `/api/download` | GET | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ |

#### `/api/files/list` ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

```json
{
  "files": [
    {
      "name": "photo.jpg",
      "size": 1024000,
      "modified": 1702123456,
      "isDirectory": false,
      "extension": "jpg"
    }
  ],
  "total": 1
}
```

#### `/api/download` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

- `filename`: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å

ä¾‹: `/api/download?filename=photo.jpg`

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒã‚’é˜²æ­¢ï¼ˆ`..`, `/`, `\`ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ‹’å¦ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
- Content-Dispositionãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚ˆã‚‹é©åˆ‡ãªãƒ•ã‚¡ã‚¤ãƒ«åè¨­å®š

## ğŸ“– é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](docs/API_REFERENCE_v1.1.md)**
- **[FAQ](docs/TROUBLESHOOTING.md)**
- **[Exampleã®èª¬æ˜](examples/README.md)**

## ğŸ¤ è²¢çŒ®

ãƒã‚°å ±å‘Šã‚„æ©Ÿèƒ½ææ¡ˆã¯ [GitHub Issues](https://github.com/tomorrow56/M5StackWiFiUploader/issues) ã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ **MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹** ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ `LICENSE` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
